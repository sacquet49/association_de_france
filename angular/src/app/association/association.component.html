<h1 class="p-col-10 p-offset-1"> Recherche des associations mise à jour avant 2009</h1>

<div *ngIf="!selectedAssociationTab">
    <div class="p-grid p-col-10 p-offset-1">
        <div class="p-col-3">
            <p-dropdown [options]="departementsDrop" [(ngModel)]="departementSelected"
                        [style]="{'width':'100%'}" filter="true" (onChange)="getVille()"
                        [showClear]="true" placeholder="Département">
                <ng-template let-item pTemplate="selectedItem">
                    <span>{{item.label}}</span>
                </ng-template>
                <ng-template let-dep pTemplate="item">
                    <div class="ui-helper-clearfix">
                        {{dep.label}}
                    </div>
                </ng-template>
            </p-dropdown>
        </div>
        <div class="p-col-3">
            <p-dropdown [options]="villesDrop" [(ngModel)]="villeSelected"
                        [style]="{'width':'100%'}" filter="true" (onChange)="rechercher()"
                        [showClear]="true" placeholder="Ville">
                <ng-template let-item pTemplate="selectedItem">
                    <span>{{item.label}}</span>
                </ng-template>
                <ng-template let-dep pTemplate="item">
                    <div class="ui-helper-clearfix">
                        {{dep.label}}
                    </div>
                </ng-template>
            </p-dropdown>
        </div>
        <div class="p-col-3">
            <p-autoComplete [(ngModel)]="query.bool.should.multi_match.query"
                            [suggestions]="subjestAssociation"
                            (completeMethod)="searchSubjestAsso()"
                            (onSelect)="rechercher()"
                            [minLength]="3"
                            placeholder="Recherche par mot clé"
                            styleClass="w-100"></p-autoComplete>
        </div>
        <div class="p-col-2">
            <button pButton type="button" label="Rechercher" pTooltip="Rechercher"
                    [style]="{'width':'100%'}" (click)="rechercher()"></button>
        </div>
        <div class="p-col-1">
            <button pButton type="button" label="Vider" pTooltip="Vider les champs de recherche"
                    [style]="{'width':'100%'}" (click)="resetFilter()"></button>
        </div>
    </div>
</div>

<div class="p-col-10 p-offset-1">
    <p-table #tableAssociation [value]="associations"
             [paginator]="true" [rows]="20" dataKey="id" [first]="'first'"
             selectionMode="single" [(selection)]="selectedAssociationTab"
             (onRowSelect)="getMap()" [hidden]="selectedAssociationTab">
        <ng-template pTemplate="emptymessage">
            <div class="pt-2 pb-2">Aucune association trouvée</div>
        </ng-template>
        <ng-template pTemplate="header">
            <tr>
                <th>Titre</th>
                <th pSortableColumn="libcom">
                    Ville
                    <p-sortIcon field="libcom"></p-sortIcon>
                </th>
                <th>Adresse</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-asso>
            <tr [pSelectableRow]="asso">
                <td>{{asso.titre}}</td>
                <td>{{asso.libcom}}</td>
                <td>{{asso.adr1}}</td>
            </tr>
        </ng-template>
    </p-table>
</div>

<div *ngIf="selectedAssociationTab">
    <div class="p-col-10 p-offset-1">
        <p-fieldset legend="Détail">
            <div class="p-grid">
                <div class="p-grid p-col-6">
                    <div class="p-col-4 ass-label-blue">Titre :</div>
                    <div class="p-col-8">{{selectedAssociationTab.titre }}</div>
                </div>
                <div class="p-grid p-col-6">
                    <div class="p-col-4 ass-label-blue">Description :</div>
                    <div class="p-col-8">{{selectedAssociationTab.objet}}</div>
                </div>
            </div>

            <div class="p-grid">
                <div class="p-grid p-col-6">
                    <div class="p-col-4 ass-label-blue">Ville :</div>
                    <div class="p-col-8">{{selectedAssociationTab.libcom}}</div>
                </div>
                <div class="p-grid p-col-6">
                    <div class="p-col-4 ass-label-blue">Code postal :</div>
                    <div class="p-col-8">{{selectedAssociationTab.adrs_codepostal}}</div>
                </div>

            </div>

            <div class="p-grid">
                <div class="p-grid p-col-6">
                    <div class="p-col-4 ass-label-blue">Adresse :</div>
                    <div class="p-col-8">{{selectedAssociationTab.adr1 }}</div>
                </div>
                <div class="p-grid p-col-6">
                    <div class="p-col-4 ass-label-blue">Date de publication :</div>
                    <div class="p-col-8">{{selectedAssociationTab.date_publi | date:'longDate'}}</div>
                </div>
            </div>

            <div class="p-grid">
                <div class="p-grid p-col-6">
                    <div class="p-col-4 ass-label-blue">Téléphone :</div>
                    <div class="p-col-8">{{selectedAssociationTab.telephone}}</div>
                </div>
                <div class="p-grid p-col-6">
                    <div class="p-col-4 ass-label-blue">Email :</div>
                    <div class="p-col-8">{{selectedAssociationTab.email }}</div>
                </div>
            </div>

            <div class="p-grid">
                <div class="p-grid p-col-6">
                    <div class="p-col-4 ass-label-blue">Siret :</div>
                    <div class="p-col-8">{{selectedAssociationTab.siret}}</div>
                </div>
                <div class="p-grid p-col-6">
                    <div class="p-col-4 ass-label-blue">Date de mise à jour :</div>
                    <div class="p-col-8">{{selectedAssociationTab.maj_time | date:'longDate' }}</div>
                </div>
            </div>
        </p-fieldset>
    </div>

    <div class="p-col-10 p-offset-1">
        <ass-carte #carteLoc [name]="'carte-asso'" [latitude]="latitude" [longitude]="longitude"></ass-carte>
    </div>

    <div class="p-col-10 p-offset-1">
        <div class="ui-rtl" dir="rtl">
            <button pButton type="button" label="Retour" (click)="backTableau()"></button>
        </div>
    </div>
</div>
